<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Analyze fusionACS microdata — analyze_fusionACS • fusionModel</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyze fusionACS microdata — analyze_fusionACS"><meta name="description" content="For fusionACS internal use only. Calculation of point estimates and associated uncertainty (margin of error) for analyses using ACS and/or fused donor survey variables.
Efficiently computes means, medians, sums, proportions, and counts, optionally across population subgroups.
The use of native ACS weights or ORNL UrbanPop synthetic population weights is automatically determined given the requested geographic resolution.
Requires a local /fusionData directory in the working directory path with assumed file structure and conventions."><meta property="og:description" content="For fusionACS internal use only. Calculation of point estimates and associated uncertainty (margin of error) for analyses using ACS and/or fused donor survey variables.
Efficiently computes means, medians, sums, proportions, and counts, optionally across population subgroups.
The use of native ACS weights or ORNL UrbanPop synthetic population weights is automatically determined given the requested geographic resolution.
Requires a local /fusionData directory in the working directory path with assumed file structure and conventions."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fusionModel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analyze fusionACS microdata</h1>

      <div class="d-none name"><code>analyze_fusionACS.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>For fusionACS internal use only. Calculation of point estimates and associated uncertainty (margin of error) for analyses using ACS and/or fused donor survey variables.
Efficiently computes means, medians, sums, proportions, and counts, optionally across population subgroups.
The use of native ACS weights or ORNL UrbanPop synthetic population weights is automatically determined given the requested geographic resolution.
Requires a local <code>/fusionData</code> directory in the working directory path with assumed file structure and conventions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">analyze_fusionACS</span><span class="op">(</span></span>
<span>  <span class="va">analyses</span>,</span>
<span>  <span class="va">year</span>,</span>
<span>  respondent <span class="op">=</span> <span class="st">"household"</span>,</span>
<span>  by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  area <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  M <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  R <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  version_up <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  force_up <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-analyses">analyses<a class="anchor" aria-label="anchor" href="#arg-analyses"></a></dt>
<dd><p>List. Specifies the desired analyses. Each analysis is a formula. See Details and Examples.</p></dd>


<dt id="arg-year">year<a class="anchor" aria-label="anchor" href="#arg-year"></a></dt>
<dd><p>Integer. One or more years for which microdata are pooled to compute <code>analyses</code> (i.e. ACS recipient year). Currently defaults to <code>year = 2015:2019</code>, if the <code>by</code> variables indicate a sub-PUMA analysis requiring UrbanPop weights.</p></dd>


<dt id="arg-respondent">respondent<a class="anchor" aria-label="anchor" href="#arg-respondent"></a></dt>
<dd><p>Character. Should the <code>analyses</code> be computed using <code>"household"</code>- or <code>"person"</code>-level microdata?</p></dd>


<dt id="arg-by">by<a class="anchor" aria-label="anchor" href="#arg-by"></a></dt>
<dd><p>Character. Optional variable(s) that collectively define the set of population subgroups for which each analysis is computed. Can be a mix of geographic (e.g. census tract) and/or socio-demographic microdata variables (e.g. poverty status); the latter may be existing variables on disk or custom variables created on-the-fly via <code>fun()</code>. If <code>NULL</code>, analysis is done for the whole (national) sample.</p></dd>


<dt id="arg-area">area<a class="anchor" aria-label="anchor" href="#arg-area"></a></dt>
<dd><p>Call. Optional unquoted call specifying a geographic area within which to compute the <code>analyses</code>. Useful for restricting the study area to a manageable size.</p></dd>


<dt id="arg-fun">fun<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>Function. Optional function for creating custom microdata variables that cannot be accommodated in <code>analyses</code>. Must take <code>data</code> and (optionally) <code>weight</code> as the only function arguments and must return a <code>data.frame</code> with number of rows equal to <code>nrow(data)</code>. See Details and Examples.</p></dd>


<dt id="arg-m">M<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p>Integer. The first <code>M</code> implicates are used. Set <code>M = Inf</code> to use all available implicates.</p></dd>


<dt id="arg-r">R<a class="anchor" aria-label="anchor" href="#arg-r"></a></dt>
<dd><p>Integer. The first <code>R</code> replicate weights are used. Set <code>R = Inf</code> to use all available replicate weights.</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>Integer. Number of cores used for multithreading in <code><a href="https://sebkrantz.github.io/collapse/reference/collapse-package.html" class="external-link">collapse-package</a></code> functions.</p></dd>


<dt id="arg-version-up">version_up<a class="anchor" aria-label="anchor" href="#arg-version-up"></a></dt>
<dd><p>Integer. Use <code>version_up = 1</code> to access national, single-implicate weights. Use <code>version_up = 2</code> to access 10-replicate weights for 17 metro areas.</p></dd>


<dt id="arg-force-up">force_up<a class="anchor" aria-label="anchor" href="#arg-force-up"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, force use of UrbanPop weights even if the requested analysis can be done using native ACS weights.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A tibble reporting analysis results, possibly across subgroups defined in <code>by</code>. The returned quantities include:</p>
<dl><dt>lhs</dt>
<dd><p>Optional analysis name; the "left hand side" of the analysis formula.</p></dd>

<dt>rhs</dt>
<dd><p>The "right hand side" of the analysis formula.</p></dd>

<dt>type</dt>
<dd><p>Type of analysis: sum, mean, median, prop(ortion) or count.</p></dd>

<dt>level</dt>
<dd><p>Factor levels for categorical analyses; NA otherwise.</p></dd>

<dt>N</dt>
<dd><p>Mean number of valid microdata observations across all implicates and replicates; i.e. the sample size used to construct the estimate.</p></dd>

<dt>est</dt>
<dd><p>Point estimate; mean estimate across all implicates and replicates.</p></dd>

<dt>moe</dt>
<dd><p>Margin of error associated with the 90% confidence interval.</p></dd>

<dt>se</dt>
<dd><p>Standard error of the estimate.</p></dd>

<dt>df</dt>
<dd><p>Degrees of freedom used to calculate the margin of error.</p></dd>

<dt>cv</dt>
<dd><p>Coefficient of variation; conventional scale-independent measure of estimate reliability. Calculated as: <code>100 * moe / 1.645 / est</code></p></dd>

<dt>rshare</dt>
<dd><p>Share of <code>moe</code> attributable to replicate weight uncertainty (as opposed to uncertainty across implicates).</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Allowable geographic units of analysis specified in <code>by</code> are currently limited to: region, division, state, cbsa10, puma10, county10, cousubfp10 (county subdivision), zcta10 (zip code), tract10 (census tract), and bg10 (block group).</p>
<p>The final point estimates are the mean estimates across implicates. The final margin of error is derived from the pooled standard error across implicates, calculated using Rubin's pooling rules (1987). The within-implicate standard error's are calculated using the replicate weights.</p>
<p>Each entry in the <code>analyses</code> list is a <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code> of the format <code>Z ~ F(E)</code>, where <code>Z</code> is an optional, user-friendly name for the analysis, <code>F</code> is an allowable “outer function”, and <code>E</code> is an “inner expression” containing one or more microdata variables. For example:</p>
<p><code>mysum ~ mean(Var1 + Var2)</code></p>
<p>In this case, the outer function is mean(). Allowable outer functions are: mean(), sum(), median(), sd(), and var(). When the inner expression contains more than one variable, it is first evaluated and then <code><a href="https://rdrr.io/r/base/logical.html" class="external-link">F()</a></code> is applied to the result. In this case, an internal variable <code>X = Var1 + Var2</code> is generated across all observations, and then <code>mean(X)</code> is computed.</p>
<p>If no inner expression is desired, the <code>analyses</code> list can use the following convenient syntax to apply a single outer function to multiple variables:</p>
<p><code>mean = c("Var1", "Var2")</code></p>
<p>The inner expression can also utilize any function that takes variable names as arguments and returns a vector with the same length as the inputs. This is useful for defining complex operations in a separate function (e.g. microsimulation). For example:</p>
<p><code>myfun = function(Var1, Var2) {Var1 + Var2}</code></p>
<p><code>mysum ~ mean(myfun(Var1, Var2))</code></p>
<p>The use of sum() or mean() with an inner expression that returns a categorical vector automatically results in category-wise weighted counts and proportions, respectively. For example, the following analysis would fail if evaluated literally, since mean() expects numeric input but the inner expression returns character. But this is interpreted as a request to return weighted proportions for each categorical outcome.</p>
<p><code>myprop ~ mean(ifelse(Var1 &gt; 10 , 'Yes', 'No'))</code></p>
<p><code>analyze_fusionACS()</code> uses "fast" versions of the allowable outer functions, as provided by <code><a href="https://sebkrantz.github.io/collapse/reference/fast-statistical-functions.html" class="external-link">fast-statistical-functions</a></code> in the <code>collapse</code> package. These functions are highly optimized for weighted, grouped calculations. In addition, outer functions mean(), sum(), and median() enjoy the use of platform-independent multithreading across columns when <code>cores &gt; 1</code>. Analyses with numerical inner expressions are processed using a series of calls to <code><a href="https://sebkrantz.github.io/collapse/reference/collap.html" class="external-link">collap</a></code> with unique observation weights. Analyses with categorical inner expressions utilize a series of calls to <code><a href="https://sebkrantz.github.io/collapse/reference/fsum.html" class="external-link">fsum</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Rubin, D.B. (1987). <em>Multiple imputation for nonresponse in surveys</em>. Hoboken, NJ: Wiley.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># Analysis using ACS native weights for year 2017, by PUMA, in South Atlantic Census Division</span></span>
<span><span class="co"># Uses all available implicates and replicate weights</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">analyze_fusionACS</span><span class="op">(</span>analyses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">high_burden</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dollarel</span> <span class="op">/</span> <span class="va">hincp</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          year <span class="op">=</span> <span class="fl">2017</span>,</span>
<span>                          by <span class="op">=</span> <span class="st">"puma10"</span>,</span>
<span>                          area <span class="op">=</span> <span class="va">division</span> <span class="op">==</span> <span class="st">"South Atlantic"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analysis using UrbanPop 2015-2019 weights, by tract, in Utah (actually Salt Lake City metro given current UrbanPop data)</span></span>
<span><span class="co"># Uses 5 (of possible 20) fusion implicates for RECS "dollarel" variable</span></span>
<span><span class="co"># Uses 5 (of possible 10) UrbanPop replicate weights</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">analyze_fusionACS</span><span class="op">(</span>analyses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">median_burden</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">dollarel</span> <span class="op">/</span> <span class="va">hincp</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          year <span class="op">=</span> <span class="fl">2015</span><span class="op">:</span><span class="fl">2019</span>,</span>
<span>                          by <span class="op">=</span> <span class="st">"tract10"</span>,</span>
<span>                          area <span class="op">=</span> <span class="va">state_name</span> <span class="op">==</span> <span class="st">"Utah"</span>,</span>
<span>                          M <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                          R <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># User function to create custom variables from microdata</span></span>
<span><span class="co"># Variables explicitly referenced in my_fun() are automatically loaded into 'data' within analyze_fusionACS()</span></span>
<span><span class="co"># Variables returned by my_fun() may be used in 'by' or inner expressions of 'analyses'</span></span>
<span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>elderly <span class="op">=</span> <span class="va">agep</span> <span class="op">&gt;=</span> <span class="fl">65</span>,</span>
<span>           energy_expend <span class="op">=</span> <span class="va">dollarel</span> <span class="op">+</span> <span class="va">dollarfo</span> <span class="op">+</span> <span class="va">dollarlp</span> <span class="op">+</span> <span class="va">dollarng</span>,</span>
<span>           energy_burden <span class="op">=</span> <span class="va">energy_expend</span> <span class="op">/</span> <span class="va">hincp</span>,</span>
<span>           energy_burden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">hincp</span> <span class="op">&lt;</span> <span class="fl">5000</span>, <span class="cn">NA</span>, <span class="va">energy_burden</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">elderly</span>, <span class="va">energy_burden</span>, <span class="va">energy_expend</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Analysis using UrbanPop 2015-2019 weights, by zip code and elderly head of household, in Atlanta CBSA</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">analyze_fusionACS</span><span class="op">(</span>analyses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">energy_burden</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">energy_burden</span><span class="op">)</span>,</span>
<span>                                          <span class="va">at_risk</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">energy_burden</span> <span class="op">&gt;</span> <span class="fl">0.075</span> <span class="op">|</span> <span class="va">acequipm_pub</span> <span class="op">==</span> <span class="st">"No air conditioning"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          year <span class="op">=</span> <span class="fl">2015</span><span class="op">:</span><span class="fl">2019</span>,</span>
<span>                          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"zcta10"</span>, <span class="st">"elderly"</span><span class="op">)</span>,</span>
<span>                          area <span class="op">=</span> <span class="va">cbsa10</span> <span class="op">==</span> <span class="st">"12060"</span>,</span>
<span>                          fun <span class="op">=</span> <span class="va">my_fun</span>,</span>
<span>                          M <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                          R <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kevin Ummel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>


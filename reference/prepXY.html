<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Optional-but-useful function to: 1) provide a plausible ordering of the 'y' (fusion) variables and 2) identify the subset of 'x' (predictor) variables likely to be consequential during subsequent model training. Output can be passed directly to train. Most useful for large datasets with many and/or highly-correlated predictors. Employs an absolute Spearman rank correlation screen and then LASSO models (via glmnet) to return a plausible ordering of 'y' and the preferred subset of 'x' variables associated with each."><title>Prepare the 'x' and 'y' inputs — prepXY • fusionModel</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prepare the 'x' and 'y' inputs — prepXY"><meta property="og:description" content="Optional-but-useful function to: 1) provide a plausible ordering of the 'y' (fusion) variables and 2) identify the subset of 'x' (predictor) variables likely to be consequential during subsequent model training. Output can be passed directly to train. Most useful for large datasets with many and/or highly-correlated predictors. Employs an absolute Spearman rank correlation screen and then LASSO models (via glmnet) to return a plausible ordering of 'y' and the preferred subset of 'x' variables associated with each."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fusionModel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Prepare the 'x' and 'y' inputs</h1>
      
      <div class="d-none name"><code>prepXY.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Optional-but-useful function to: 1) provide a plausible ordering of the 'y' (fusion) variables and 2) identify the subset of 'x' (predictor) variables likely to be consequential during subsequent model training. Output can be passed directly to <code><a href="train.html">train</a></code>. Most useful for large datasets with many and/or highly-correlated predictors. Employs an absolute Spearman rank correlation screen and then LASSO models (via <code><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></code>) to return a plausible ordering of 'y' and the preferred subset of 'x' variables associated with each.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prepXY</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  weight <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cor_thresh <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  lasso_thresh <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  xmax <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  xforce <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fraction <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>Data frame. Training dataset. All categorical variables should be factors and ordered whenever possible.</p></dd>


<dt>y</dt>
<dd><p>Character or list. Variables in <code>data</code> to eventually fuse to a recipient dataset. If <code>y</code> is a list, each entry is a character vector possibly indicating multiple variables to fuse as a block.</p></dd>


<dt>x</dt>
<dd><p>Character. Predictor variables in <code>data</code> common to donor and eventual recipient.</p></dd>


<dt>weight</dt>
<dd><p>Character. Name of the observation weights column in <code>data</code>. If NULL (default), uniform weights are assumed.</p></dd>


<dt>cor_thresh</dt>
<dd><p>Numeric. Predictors that exhibit less than <code>cor_thresh</code> absolute Spearman (rank) correlation with a <code>y</code> variable are screened out prior to the LASSO step. Fast exclusion of predictors that the LASSO step probably doesn't need to consider.</p></dd>


<dt>lasso_thresh</dt>
<dd><p>Numeric. Controls how aggressively the LASSO step screens out predictors. Lower value is more aggressive. <code>lasso_thresh = 0.95</code>, for example, retains predictors that collectively explain at least 95% of the deviance explained by a "full" model.</p></dd>


<dt>xmax</dt>
<dd><p>Integer. Maximum number of predictors returned by LASSO step. Does not strictly control the number of final predictors returned (especially for categorical <code>y</code> variables), but useful for setting a (very) soft upper bound. Lower <code>xmax</code> can help control computation time if a large number of <code>x</code> pass the correlation screen. <code>xmax = Inf</code> imposes no restriction.</p></dd>


<dt>xforce</dt>
<dd><p>Character. Subset of <code>x</code> variables to "force" as included predictors in the results.</p></dd>


<dt>fraction</dt>
<dd><p>Numeric. Fraction of observations in <code>data</code> to randomly sample. For larger datasets, sampling often has minimal effect on results but speeds up computation.</p></dd>


<dt>cores</dt>
<dd><p>Integer. Number of cores used. Only applicable on Unix systems.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>List with named slots "y" and "x". Each is a list of the same length. Former gives the preferred fusion order. Latter gives the preferred sets of predictor variables.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">recs</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span><span class="op">:</span><span class="fl">16</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">22</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">recs</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fusion variable "blocks" are respected by prepXY()</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="va">y</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Do the prep work...</span></span></span>
<span class="r-in"><span><span class="va">prep</span> <span class="op">&lt;-</span> <span class="fu">prepXY</span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>, y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Identifying 'x' that pass absolute Spearman correlation threshold</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitting full models for each 'y'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteratively constructing preferred fusion order</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Retained 12 of 12 predictor variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total processing time: 1.07 secs </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The result can be passed to train()</span></span></span>
<span class="r-in"><span><span class="fu"><a href="train.html">train</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>, y <span class="op">=</span> <span class="va">prep</span><span class="op">$</span><span class="va">y</span>, x <span class="op">=</span> <span class="va">prep</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 fusion variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 initial predictor variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5686 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using specified set of predictors for each fusion variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 1 of 5: aircon</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 2 of 5: square_feet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.978 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    70.0   179.0   214.3   354.0   499.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 3 of 5: electricity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.971 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    60.0   127.0   171.1   249.0   498.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 4 of 5: natural_gas</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.973 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    65.0   138.0   186.4   289.0   499.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 5 of 5: heat_type, insulation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fusion model saved to:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  /home/runner/work/fusionModel/fusionModel/docs/reference/fusion_model.fsn </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total processing time: 14.3 secs </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Kevin Ummel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>


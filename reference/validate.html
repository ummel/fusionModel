<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Performs internal validation analyses on fused microdata to estimate how well the simulated variables reflect patterns in the dataset used to train the underlying fusion model (i.e. observed/donor data). This provides a standard approach to validating fusion output and associated models. See Examples for recommended usage."><title>Validate fusion output — validate • fusionModel</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validate fusion output — validate"><meta property="og:description" content="Performs internal validation analyses on fused microdata to estimate how well the simulated variables reflect patterns in the dataset used to train the underlying fusion model (i.e. observed/donor data). This provides a standard approach to validating fusion output and associated models. See Examples for recommended usage."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fusionModel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Validate fusion output</h1>
      
      <div class="d-none name"><code>validate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs internal validation analyses on fused microdata to estimate how well the simulated variables reflect patterns in the dataset used to train the underlying fusion model (i.e. observed/donor data). This provides a standard approach to validating fusion output and associated models. See Examples for recommended usage.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">validate</span><span class="op">(</span></span>
<span>  <span class="va">observed</span>,</span>
<span>  <span class="va">implicates</span>,</span>
<span>  <span class="va">subset_vars</span>,</span>
<span>  weight <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_size <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>observed</dt>
<dd><p>Data frame. Observed data against which to validate the <code>simulated</code> variables. Typically the same dataset used to <code><a href="train.html">train</a></code> the fusion model used to generate <code>simulated</code>.</p></dd>


<dt>implicates</dt>
<dd><p>Data frame. Implicates of synthetic (fused) variables. Typically generated by <a href="fuse.html">fuse</a>. The implicates should be row-stacked and identified by integer column "M".</p></dd>


<dt>subset_vars</dt>
<dd><p>Character. Vector of columns in <code>observed</code> used to define the population subsets across which the fusion variables are validated. The levels of each <code>subset_vars</code> (including all two-way interactions of <code>subset_vars</code>) define the population subsets. Continuous <code>subset_vars</code> are converted to a five-level ordered factor based on a univariate k-means clustering.</p></dd>


<dt>weight</dt>
<dd><p>Character. Name of the observation weights column in <code>observed</code>. If NULL (default), uniform weights are assumed.</p></dd>


<dt>min_size</dt>
<dd><p>Integer. Subsets with less than <code>min_size</code> observations are excluded. Since subsets with few observations are unlikely to give reliable estimates, it doesn't make sense to consider them for validation purposes.</p></dd>


<dt>plot</dt>
<dd><p>Logical. If TRUE (default), <code><a href="plot_valid.html">plot_valid</a></code> is called internally and summary plots are returned along with complete validation results. Requires the <code>ggplot2</code> package.</p></dd>


<dt>cores</dt>
<dd><p>Integer. Number of cores used. Only applicable on Unix systems.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>If <code>plot = FALSE</code>, a data frame containing complete validation results. If If <code>plot = FALSE</code>, a list containing full results as well as additional lot objects as described in <code><a href="plot_valid.html">plot_valid</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The objective of <code>validate</code> is to confirm that the fusion output is sensible and help establish the utility of the synthetic data across myriad analyses. Utility here is based on comparison of point estimates and confidence intervals derived using multiple-implicate synthetic data with those derived using the original donor data.</p>
<p>The specific analyses tested include variable levels (means and proportions) across population subsets of varying size. This allows estimates of how each of the synthetic variables perform in analyses with real-world relevance, at varying levels of complexity. In effect, <code>validate()</code> performs a large number of analyses of the kind that the <code><a href="analyze.html">analyze</a></code> function is designed to do on a one-by-one basis.</p>
<p>Most users will want to use the default setting <code>plot = TRUE</code> to simultaneously return visualization (plots) of the validation results. Plot creation is detailed in <code><a href="plot_valid.html">plot_valid</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Build a fusion model using RECS microdata</span></span></span>
<span class="r-in"><span><span class="co"># Note that "fusion_model.fsn" will be written to working directory</span></span></span>
<span class="r-in"><span><span class="va">fusion.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"electricity"</span>, <span class="st">"natural_gas"</span>, <span class="st">"aircon"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">predictor.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">recs</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">fsn.path</span> <span class="op">&lt;-</span> <span class="fu"><a href="train.html">train</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>,</span></span>
<span class="r-in"><span>                  y <span class="op">=</span> <span class="va">fusion.vars</span>,</span></span>
<span class="r-in"><span>                  x <span class="op">=</span> <span class="va">predictor.vars</span>,</span></span>
<span class="r-in"><span>                  weight <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 fusion variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 initial predictor variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5686 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using all available predictors for each fusion variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Training step 1 of 3: electricity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- R-squared of cluster means: 0.975 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    82.0   183.0   212.4   336.0   498.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Training step 2 of 3: natural_gas</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- R-squared of cluster means: 0.975 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    62.0   137.0   190.1   308.0   497.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Training step 3 of 3: aircon</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fusion model saved to:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  /home/runner/work/fusionModel/fusionModel/docs/reference/fusion_model.fsn </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total processing time: 6.17 secs </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fuse back onto the donor data (multiple implicates)</span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="fuse.html">fuse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>,</span></span>
<span class="r-in"><span>            fsn <span class="op">=</span> <span class="va">fsn.path</span>,</span></span>
<span class="r-in"><span>            M <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 fusion variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 initial predictor variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5686 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Generating 40 implicates </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fusion step 1 of 3: electricity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Predicting LightGBM models</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Simulating fused values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fusion step 2 of 3: natural_gas</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Predicting LightGBM models</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Simulating fused values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fusion step 3 of 3: aircon</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Predicting LightGBM models</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Simulating fused values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total processing time: 9.77 secs </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate validation results</span></span></span>
<span class="r-in"><span><span class="va">valid</span> <span class="op">&lt;-</span> <span class="fu">validate</span><span class="op">(</span>observed <span class="op">=</span> <span class="va">recs</span>,</span></span>
<span class="r-in"><span>                  implicates <span class="op">=</span> <span class="va">sim</span>,</span></span>
<span class="r-in"><span>                  subset_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span>, <span class="st">"education"</span>, <span class="st">"race"</span>, <span class="st">"urban_rural"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  weight <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> One-hot encoding categorical fusion variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Correlation between observed and fused values:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.043   0.202   0.234   0.277   0.406   0.498 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing validation analyses for 3 fusion variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Performed 642 analyses across 107 subsets</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Smoothing validation metrics</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average smoothed performance metrics across subset range:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              y     est    vad   moe</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       aircon  0.0356  0.702  1.38</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  electricity  0.0159  0.718  1.14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  natural_gas  0.0175  0.841  1.21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Creating ggplot2 graphics  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total processing time: 2.67 secs </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Kevin Ummel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='Train a fusion model on "donor" data using sequential LightGBM models to model the conditional distributions. The resulting fusion model (.fsn file) can be used with fuse to simulate outcomes for a "recipient" dataset.'><title>Train a fusion model — train • fusionModel</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Train a fusion model — train"><meta property="og:description" content='Train a fusion model on "donor" data using sequential LightGBM models to model the conditional distributions. The resulting fusion model (.fsn file) can be used with fuse to simulate outcomes for a "recipient" dataset.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fusionModel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Train a fusion model</h1>
      
      <div class="d-none name"><code>train.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Train a fusion model on "donor" data using sequential <a href="https://lightgbm.readthedocs.io/en/latest/" class="external-link">LightGBM</a> models to model the conditional distributions. The resulting fusion model (.fsn file) can be used with <code><a href="fuse.html">fuse</a></code> to simulate outcomes for a "recipient" dataset.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">train</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  fsn <span class="op">=</span> <span class="st">"fusion_model.fsn"</span>,</span>
<span>  weight <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nfolds <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  nquantiles <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  nclusters <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  krange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>  hyper <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fork <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>Data frame. Donor dataset. Categorical variables must be factors and ordered whenever possible.</p></dd>


<dt>y</dt>
<dd><p>Character or list. Variables in <code>data</code> to eventually fuse to a recipient dataset. Variables are fused in the order provided. If <code>y</code> is a list, each entry is a character vector possibly indicating multiple variables to fuse as a block.</p></dd>


<dt>x</dt>
<dd><p>Character or list. Predictor variables in <code>data</code> common to donor and eventual recipient. If a list, each slot specifies the <code>x</code> predictors to use for each <code>y</code>.</p></dd>


<dt>fsn</dt>
<dd><p>Character. File path where fusion model will be saved. Must use <code>.fsn</code> suffix.</p></dd>


<dt>weight</dt>
<dd><p>Character. Name of the observation weights column in <code>data</code>. If NULL (default), uniform weights are assumed.</p></dd>


<dt>nfolds</dt>
<dd><p>Numeric. Number of cross-validation folds used for LightGBM model training. Or, if <code>nfolds &lt; 1</code>, the fraction of observations to use for training set; remainder used for validation (faster than cross-validation).</p></dd>


<dt>nquantiles</dt>
<dd><p>Numeric. Number of quantile models to train for continuous <code>y</code> variables (along with the conditional mean). <code>nquantiles</code> evenly-distributed percentiles are used. The default <code>nquantiles = 3</code> is usually sufficient and yields quantile models for the 16.6th, 50th, and 83.3rd percentiles.</p></dd>


<dt>nclusters</dt>
<dd><p>Numeric. Maximum number of k-means clusters to use. Higher is better but at computational cost. <code>nclusters = 0</code> or <code>nclusters = Inf</code> turn off clustering.</p></dd>


<dt>krange</dt>
<dd><p>Numeric. Minimum and maximum number of nearest neighbors to use for construction of continuous conditional distributions. Higher <code>max(krange)</code> is better but at computational cost.</p></dd>


<dt>hyper</dt>
<dd><p>List. LightGBM hyperparameters to be used during model training. If <code>NULL</code>, default values are used. See Details and Examples.</p></dd>


<dt>fork</dt>
<dd><p>Logical. Should parallel processing via forking be used, if possible? See Details.</p></dd>


<dt>cores</dt>
<dd><p>Integer. Number of physical CPU cores used for parallel computation. When <code>fork = FALSE</code> or on Windows platform (since forking is not possible), the fusion variables/blocks are processed serially but LightGBM uses <code>cores</code> for internal multithreading via OpenMP. On a Unix system, if <code>fork = TRUE</code>, <code>cores &gt; 1</code>, and <code>cores &lt;= length(y)</code> then the fusion variables/blocks are processed in parallel via <code><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A fusion model object (.fsn) is saved to <code>fsn</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When <code>y</code> is a list, each slot indicates either a single variable or, alternatively, multiple variables to fuse as a block. Variables within a block are sampled jointly from the original donor data during fusion. See Examples.</p>
<p><code>y</code> variables that exhibit no variance or continuous <code>y</code> variables with less than <code>10 * nfolds</code> non-zero observations (minimum required for cross-validation) are automatically removed with a warning.</p>
<p>The fusion model written to <code>fsn</code> is a zipped archive created by <code><a href="https://rdrr.io/pkg/zip/man/zip.html" class="external-link">zip</a></code> containing models and data required by <code><a href="fuse.html">fuse</a></code>.</p>
<p>The <code>hyper</code> argument can be used to specify the LightGBM hyperparameter values over which to perform a "grid search" during model training. <a href="https://lightgbm.readthedocs.io/en/latest/Parameters.html" class="external-link">See here</a> for the full list of parameters. For each combination of hyperparameters, <code>nfolds</code> cross-validation is performed using <code><a href="https://rdrr.io/pkg/lightgbm/man/lgb.cv.html" class="external-link">lgb.cv</a></code> with an early stopping condition. The parameter combination with the lowest loss function value is used to fit the final model via <code><a href="https://rdrr.io/pkg/lightgbm/man/lgb.train.html" class="external-link">lgb.train</a></code>. The more candidate parameter values specified in <code>hyper</code>, the longer the processing time. If <code>hyper = NULL</code>, a single set of parameters is used LightGBM default values. Typically, users will only have reason to specify the following parameters via <code>hyper</code>:</p>
<ul><li><p>boosting</p></li>
<li><p>num_leaves</p></li>
<li><p>bagging_fraction</p></li>
<li><p>feature_fraction</p></li>
<li><p>max_depth</p></li>
<li><p>min_data_in_leaf</p></li>
<li><p>num_iterations</p></li>
<li><p>learning_rate</p></li>
<li><p>max_bin</p></li>
<li><p>min_data_in_bin</p></li>
<li><p>max_cat_threshold</p></li>
</ul><p>Testing with small-to-medium size datasets suggests that forking is typically faster than OpenMP multithreading (the default). However, forking will sometimes "hang" (continue to run with no CPU usage or error message) if an OpenMP process has been previously used in the same session. The issue appears to be related to Intel's OpenMP implementation (<a href="https://github.com/Rdatatable/data.table/issues/2418" class="external-link">see here</a>). This can be triggered when other operations are called before <code>train()</code> that use <code><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> or <code><a href="http://www.fstpackage.org/reference/fst.html" class="external-link">fst</a></code> in multithread mode. If you experience hanged forking, try calling <code>data.table::setDTthreads(1)</code> and <code>fst::threads_fst(1)</code> immediately after <code><a href="https://ummel.github.io/fusionModel/">library(fusionModel)</a></code> in a new session.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Build a fusion model using RECS microdata</span></span></span>
<span class="r-in"><span><span class="co"># Note that "fusion_model.fsn" will be written to working directory</span></span></span>
<span class="r-in"><span><span class="op">?</span><span class="va">recs</span></span></span>
<span class="r-in"><span><span class="va">fusion.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"electricity"</span>, <span class="st">"natural_gas"</span>, <span class="st">"aircon"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">predictor.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">recs</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">fsn.path</span> <span class="op">&lt;-</span> <span class="fu">train</span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>, y <span class="op">=</span> <span class="va">fusion.vars</span>, x <span class="op">=</span> <span class="va">predictor.vars</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 fusion variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 initial predictor variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5686 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using all available predictors for each fusion variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 1 of 3: electricity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.97 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    72.0   147.0   194.8   301.0   499.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 2 of 3: natural_gas</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.977 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    66.0   147.0   195.3   322.2   497.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 3 of 3: aircon</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fusion model saved to:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  /home/runner/work/fusionModel/fusionModel/docs/reference/fusion_model.fsn </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total processing time: 6.37 secs </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># When 'y' is a list, it can specify variables to fuse as a block</span></span></span>
<span class="r-in"><span><span class="va">fusion.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"electricity"</span>, <span class="st">"natural_gas"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"heating_share"</span>, <span class="st">"cooling_share"</span>, <span class="st">"other_share"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fusion.vars</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "electricity"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "natural_gas"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "heating_share" "cooling_share" "other_share"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu">train</span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>, y <span class="op">=</span> <span class="va">fusion.vars</span>, x <span class="op">=</span> <span class="va">predictor.vars</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 fusion variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 initial predictor variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5686 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using all available predictors for each fusion variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 1 of 3: electricity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.974 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    69.0   152.0   199.4   316.0   499.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 2 of 3: natural_gas</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.975 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    69.0   152.5   193.9   308.2   499.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 3 of 3: heating_share, cooling_share, other_share</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fusion model saved to:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  /home/runner/work/fusionModel/fusionModel/docs/reference/fusion_model.fsn </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total processing time: 14.1 secs </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># When 'x' is a list, it specifies which predictor variables to use for each 'y'</span></span></span>
<span class="r-in"><span><span class="va">xlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">predictor.vars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">predictor.vars</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, <span class="va">predictor.vars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xlist</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "income"    "age"       "race"      "education"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "age"         "race"        "education"   "employment"  "hh_size"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "division"    "urban_rural"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "income"      "age"         "race"        "education"   "employment" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] "hh_size"     "division"    "urban_rural" "climate"     "renter"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "home_type"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu">train</span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>, y <span class="op">=</span> <span class="va">fusion.vars</span>, x <span class="op">=</span> <span class="va">xlist</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 fusion variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 initial predictor variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5686 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using specified set of predictors for each fusion variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 1 of 3: electricity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.918 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0   107.0   222.0   240.6   379.0   499.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 2 of 3: natural_gas</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.957 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    64.0   172.0   212.6   357.8   499.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 3 of 3: heating_share, cooling_share, other_share</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fusion model saved to:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  /home/runner/work/fusionModel/fusionModel/docs/reference/fusion_model.fsn </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total processing time: 13.1 secs </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specify a single set of LightGBM hyperparameters</span></span></span>
<span class="r-in"><span><span class="fu">train</span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>, y <span class="op">=</span> <span class="va">fusion.vars</span>, x <span class="op">=</span> <span class="va">predictor.vars</span>,</span></span>
<span class="r-in"><span>      hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>boosting <span class="op">=</span> <span class="st">"goss"</span>,</span></span>
<span class="r-in"><span>                   feature_fraction <span class="op">=</span> <span class="fl">0.8</span>,</span></span>
<span class="r-in"><span>                   num_iterations <span class="op">=</span> <span class="fl">300</span></span></span>
<span class="r-in"><span>      <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 fusion variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 initial predictor variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5686 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using all available predictors for each fusion variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 1 of 3: electricity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.968 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      10      68     151     194     301     499 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 2 of 3: natural_gas</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.963 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    62.0   149.0   189.5   297.0   497.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 3 of 3: heating_share, cooling_share, other_share</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fusion model saved to:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  /home/runner/work/fusionModel/fusionModel/docs/reference/fusion_model.fsn </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total processing time: 16.7 secs </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specify a range of LightGBM hyperparameters to search over</span></span></span>
<span class="r-in"><span><span class="co"># This takes longer, because there are more models to test</span></span></span>
<span class="r-in"><span><span class="fu">train</span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>, y <span class="op">=</span> <span class="va">fusion.vars</span>, x <span class="op">=</span> <span class="va">predictor.vars</span>,</span></span>
<span class="r-in"><span>      hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num_leaves <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   feature_fraction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   num_iterations <span class="op">=</span> <span class="fl">50</span></span></span>
<span class="r-in"><span>      <span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 fusion variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 initial predictor variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5686 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using all available predictors for each fusion variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 1 of 3: electricity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.975 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      10      89     185     216     339     498 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 2 of 3: natural_gas</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- R-squared of cluster means: 0.984 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    62.0   141.0   183.1   280.5   498.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Training step 3 of 3: heating_share, cooling_share, other_share</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fusion model saved to:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  /home/runner/work/fusionModel/fusionModel/docs/reference/fusion_model.fsn </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total processing time: 32.2 secs </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Kevin Ummel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>


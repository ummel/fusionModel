<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Analyze fusion output — analyze • fusionModel</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyze fusion output — analyze"><meta name="description" content="Calculation of point estimates and associated margin of error for analyses using fused/synthetic microdata. Can calculate means, proportions, sums, counts, and medians, optionally across population subgroups."><meta property="og:description" content="Calculation of point estimates and associated margin of error for analyses using fused/synthetic microdata. Can calculate means, proportions, sums, counts, and medians, optionally across population subgroups."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fusionModel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analyze fusion output</h1>

      <div class="d-none name"><code>analyze.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculation of point estimates and associated margin of error for analyses using fused/synthetic microdata. Can calculate means, proportions, sums, counts, and medians, optionally across population subgroups.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">analyze</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">implicates</span>,</span>
<span>  static <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weight <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rep_weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fun <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var_scale <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>List. Named list specifying the desired analysis type(s) and the associated target variable(s). Example: <code>x = list(mean = c("v1", "v2"), median = "v3")</code> translates as: "Return the mean value of variables v1 and v2 and the median of v3". Supported analysis types include <code>mean</code>, <code>sum</code>, and <code>median</code>. Mean and sum automatically return proportions and counts, respectively, if the target variable is a factor. Target variables must be in <code>implicates</code>, <code>static</code>, or a data.frame returned by a custom <code>fun</code>.</p></dd>


<dt id="arg-implicates">implicates<a class="anchor" aria-label="anchor" href="#arg-implicates"></a></dt>
<dd><p>Data frame. Implicates of synthetic (fused) variables. Typically generated by <a href="fuse.html">fuse</a>. The implicates should be row-stacked and identified by integer column "M".</p></dd>


<dt id="arg-static">static<a class="anchor" aria-label="anchor" href="#arg-static"></a></dt>
<dd><p>Data frame. Optional static (non-synthetic) variables that do not vary across implicates. Note that <code>nrow(static) = nrow(implicates) / max(implicates$M)</code> and the row-ordering is assumed to be consistent between <code>static</code> and <code>implicates</code>.</p></dd>


<dt id="arg-weight">weight<a class="anchor" aria-label="anchor" href="#arg-weight"></a></dt>
<dd><p>Character. Name of the observation weights column in <code>static</code>. If NULL (default), uniform weights are assumed.</p></dd>


<dt id="arg-rep-weights">rep_weights<a class="anchor" aria-label="anchor" href="#arg-rep-weights"></a></dt>
<dd><p>Character. Optional vector of replicate weight columns in <code>static</code>. If provided, the returned margin of errors reflect additional variance due to uncertainty in sample weights.</p></dd>


<dt id="arg-by">by<a class="anchor" aria-label="anchor" href="#arg-by"></a></dt>
<dd><p>Character. Optional column name(s) in <code>implicates</code> or <code>static</code> (typically factors) that collectively define the set of population subgroups for which each analysis is executed. If <code>NULL</code>, analysis is done for the whole sample.</p></dd>


<dt id="arg-fun">fun<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>Function. Optional function applied to input data prior to executing analyses. Can be used to do non-conventional/custom analyses.</p></dd>


<dt id="arg-var-scale">var_scale<a class="anchor" aria-label="anchor" href="#arg-var-scale"></a></dt>
<dd><p>Scalar. Factor by which to scale the unadjusted replicate weight variance. This is determined by the survey design. The default (<code>var_scale = 4</code>) is appropriate for ACS and RECS.</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>Integer. Number of cores used. Only applicable on Unix systems.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.table reporting analysis results, possibly across subgroups defined in <code>by</code>. The returned quantities include:</p>
<dl><dt>N</dt>
<dd><p>Number of observations used for the analysis.</p></dd>

<dt>y</dt>
<dd><p>Target variable.</p></dd>

<dt>level</dt>
<dd><p>Levels of factor target variables.</p></dd>

<dt>type</dt>
<dd><p>Type of estimate returned: mean, proportion, sum, count, or median.</p></dd>

<dt>est</dt>
<dd><p>Point estimate.</p></dd>

<dt>moe</dt>
<dd><p>Margin of error associated with the 90% confidence interval.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>At a minimum, the user must supply synthetic implicates (typically generated by <a href="fuse.html">fuse</a>). Inputs are checked for consistent dimensions.</p>
<p>If <code>implicates</code> contains only a single implicate and <code>rep_weights = NULL</code>, the "typical" standard error is returned with a warning to make sure the user is aware of the situation.</p>
<p>Estimates and standard errors for the requested analysis are calculated separately for each implicate. The final point estimate is the mean estimate across implicates. The final standard error is the pooled SE across implicates, calculated using Rubin's pooling rules (1987) with a finite population adjustment of the degrees of freedom (Barnard and Rubin 1999).</p>
<p>When replicate weights are provided, the standard errors of each implicate are calculated via the variance of estimates across replicates. Calculations leverage <code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code> operations for speed and memory efficiency. The within-implicate variance is calculated around the point estimate (rather than around the mean of the replicates). This is equivalent to <code>mse = TRUE</code> in <code>svrepdesign</code>. This seems to be the appropriate method for most surveys.</p>
<p>If replicate weights are NOT provided, the standard errors of each implicate are calculated using variance within the implicate. For means, the ratio variance approximation of Cochran (1977) is used, as this is known to be a good approximation of bootstrapped SE's for weighted means (Gatz and Smith 1995). For proportions, a generalization of the unweighted SE formula is used (<a href="https://stats.stackexchange.com/questions/159204/how-to-calculate-the-standard-error-of-a-proportion-using-weighted-data" class="external-link">see here</a>). For regression coefficients, the standard error is calculated by <code><a href="https://rdrr.io/r/stats/summary.glm.html" class="external-link">summary.glm</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Barnard, J., &amp; Rubin, D.B. (1999). Small-sample degrees of freedom with multiple imputation. <em>Biometrika, 86</em>, 948-955.</p>
<p>Cochran, W. G. (1977). <em>Sampling Techniques</em> (3rd Edition). Wiley, New York.</p>
<p>Gatz, D.F., and Smith, L. (1995). The Standard Error of a Weighted Mean Concentration — I. Bootstrapping vs Other Methods. <em>Atmospheric Environment</em>, vol. 29, no. 11, 1185–1193.</p>
<p>Rubin, D.B. (1987). <em>Multiple imputation for nonresponse in surveys</em>. Hoboken, NJ: Wiley.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># Build a fusion model using RECS microdata</span></span>
<span><span class="va">fusion.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"electricity"</span>, <span class="st">"natural_gas"</span>, <span class="st">"aircon"</span><span class="op">)</span></span>
<span><span class="va">predictor.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">recs</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span></span>
<span><span class="va">fsn.path</span> <span class="op">&lt;-</span> <span class="fu"><a href="train.html">train</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>, y <span class="op">=</span> <span class="va">fusion.vars</span>, x <span class="op">=</span> <span class="va">predictor.vars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate 30 implicates of the 'fusion.vars' using original RECS as the recipient</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="fuse.html">fuse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>, fsn <span class="op">=</span> <span class="va">fsn.path</span>, M <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#---------</span></span>
<span></span>
<span><span class="co"># Multiple types of analyses can be done at once</span></span>
<span><span class="co"># This calculates estimates using the full sample</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">analyze</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"natural_gas"</span>, <span class="st">"aircon"</span><span class="op">)</span>,</span>
<span>                           median <span class="op">=</span> <span class="st">"electricity"</span>,</span>
<span>                           sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"electricity"</span>, <span class="st">"aircon"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  implicates <span class="op">=</span> <span class="va">sim</span>,</span>
<span>                  weight <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#-----</span></span>
<span></span>
<span><span class="co"># Mean electricity consumption, by climate zone and urban/rural status</span></span>
<span><span class="va">result1</span> <span class="op">&lt;-</span> <span class="fu">analyze</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="st">"electricity"</span><span class="op">)</span>,</span>
<span>                  implicates <span class="op">=</span> <span class="va">sim</span>,</span>
<span>                  static <span class="op">=</span> <span class="va">recs</span>,</span>
<span>                  weight <span class="op">=</span> <span class="st">"weight"</span>,</span>
<span>                  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"climate"</span>, <span class="st">"urban_rural"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Same as above but including sample weight uncertainty</span></span>
<span><span class="co"># Note that only the first 30 replicate weights are used internally</span></span>
<span><span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu">analyze</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="st">"electricity"</span><span class="op">)</span>,</span>
<span>                  implicates <span class="op">=</span> <span class="va">sim</span>,</span>
<span>                  static <span class="op">=</span> <span class="va">recs</span>,</span>
<span>                  weight <span class="op">=</span> <span class="st">"weight"</span>,</span>
<span>                  rep_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"rep_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">96</span><span class="op">)</span>,</span>
<span>                  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"climate"</span>, <span class="st">"urban_rural"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Helper function for comparison plots</span></span>
<span><span class="va">pfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Inclusion of replicate weights does not affect estimates, but it does</span></span>
<span><span class="co"># increase margin of error due to uncertainty in RECS sample weights</span></span>
<span><span class="fu">pfun</span><span class="op">(</span><span class="va">result1</span><span class="op">$</span><span class="va">est</span>, <span class="va">result2</span><span class="op">$</span><span class="va">est</span><span class="op">)</span></span>
<span><span class="fu">pfun</span><span class="op">(</span><span class="va">result1</span><span class="op">$</span><span class="va">moe</span>, <span class="va">result2</span><span class="op">$</span><span class="va">moe</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Notice that relative uncertainty declines with subset size</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result1</span><span class="op">$</span><span class="va">N</span>, <span class="va">result1</span><span class="op">$</span><span class="va">moe</span> <span class="op">/</span> <span class="va">result1</span><span class="op">$</span><span class="va">est</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#-----</span></span>
<span></span>
<span><span class="co"># Use a custom function to perform more complex analyses</span></span>
<span><span class="co"># Custom function should return a data frame with non-standard target variables</span></span>
<span></span>
<span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Manipulate 'data' as desired</span></span>
<span>  <span class="co"># All variables in 'implicates' and 'static' are available</span></span>
<span></span>
<span>  <span class="co"># Construct electricity consumption per square foot</span></span>
<span>  <span class="va">kwh_per_ft2</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">electricity</span> <span class="op">/</span> <span class="va">data</span><span class="op">$</span><span class="va">square_feet</span></span>
<span></span>
<span>  <span class="co"># Binary (T/F) indicator if household uses natural gas</span></span>
<span>  <span class="va">use_natural_gas</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">natural_gas</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span></span>
<span>  <span class="co"># Return data.frame of custom variables to be analyzed</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">kwh_per_ft2</span>, <span class="va">use_natural_gas</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Do analysis using variables produced by custom function</span></span>
<span><span class="co"># Can included non-custom target variables as well</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">analyze</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kwh_per_ft2"</span>, <span class="st">"use_natural_gas"</span>, <span class="st">"electricity"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  implicates <span class="op">=</span> <span class="va">sim</span>,</span>
<span>                  static <span class="op">=</span> <span class="va">recs</span>,</span>
<span>                  weight <span class="op">=</span> <span class="st">"weight"</span>,</span>
<span>                  fun <span class="op">=</span> <span class="va">my_fun</span><span class="op">)</span></span>
<span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kevin Ummel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>


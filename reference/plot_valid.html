<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Creates and optionally saves to disk representative plots of validation results returned by validate. Requires the suggested ggplot2 package. This function is (by default) called within validate. Can be useful on its own to save graphics to disk or generate plots for a subset of fusion variables."><title>Plot validation results — plot_valid • fusionModel</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plot validation results — plot_valid"><meta property="og:description" content="Creates and optionally saves to disk representative plots of validation results returned by validate. Requires the suggested ggplot2 package. This function is (by default) called within validate. Can be useful on its own to save graphics to disk or generate plots for a subset of fusion variables."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fusionModel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Plot validation results</h1>
      
      <div class="d-none name"><code>plot_valid.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates and optionally saves to disk representative plots of validation results returned by <code><a href="validate.html">validate</a></code>. Requires the suggested <code>ggplot2</code> package. This function is (by default) called within <code><a href="validate.html">validate</a></code>. Can be useful on its own to save graphics to disk or generate plots for a subset of fusion variables.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">plot_valid</span><span class="op">(</span><span class="va">valid</span>, y <span class="op">=</span> <span class="cn">NULL</span>, path <span class="op">=</span> <span class="cn">NULL</span>, cores <span class="op">=</span> <span class="fl">1</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>valid</dt>
<dd><p>Object returned by <code><a href="validate.html">validate</a></code>.</p></dd>


<dt>y</dt>
<dd><p>Character. Fusion variables to use for validation graphics. Useful for plotting partial validation results. Default is to use all fusion variables present in <code>valid</code>.</p></dd>


<dt>path</dt>
<dd><p>Character. Path to directory where .png graphics are to be saved. Directory is created if necessary. If NULL (default), no files are saved to disk.</p></dd>


<dt>cores</dt>
<dd><p>Integer. Number of cores used. Only applicable on Unix systems.</p></dd>


<dt>...</dt>
<dd><p>Arguments passed to <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></code> to control .png graphics saved to disk.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with "plots", "smooth", and "data" slots. The "plots" slot contains the following <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></code> objects:</p><ul><li><p>est: Comparison of point estimates (median absolute percent error).</p></li>
<li><p>moe: Comparison of 90% margin of error (median ratio of simulated-to-observed MOE).</p></li>
<li><p>Additional named slots (one for each of the fusion variables) contain the plots described above with scatterplot results.</p></li>
</ul><p>"smooth" is a data frame with the plotting values used to produce the smoothed median plots.
"data" is a data frame with the complete validation results as returned by the original call to <code><a href="validate.html">validate</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Validation results are visualized to convey expected, typical (median) performance of the fusion variables. That is, how well do the simulated data match the observed data with respect to point estimates and confidence intervals for population subsets of various size?</p>
<p>Plausible error metrics are derived from the input validation data for plotting. For comparison of point estimates, the error metric is absolute percent error for continuous variables; in the categorical case it is absolute error scaled such that the maximum possible error is 1. Since these metrics are not strictly comparable, the all-variable plots denote categorical fusion variables with dotted lines.</p>
<p>For a given fusion variable, the error metric will exhibit variation (often quite skewed) even for subsets of comparable size, due to the fact that each subset looks at a unique partition of the data. In order to convey how expected, typical performance varies with subset size, the smoothed median error conditional on subset size is approximated and plotted.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Build a fusion model using RECS microdata</span></span></span>
<span class="r-in"><span><span class="co"># Note that "fusion_model.fsn" will be written to working directory</span></span></span>
<span class="r-in"><span><span class="va">fusion.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"electricity"</span>, <span class="st">"natural_gas"</span>, <span class="st">"aircon"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">predictor.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">recs</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">fsn.path</span> <span class="op">&lt;-</span> <span class="fu"><a href="train.html">train</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>,</span></span>
<span class="r-in"><span>                  y <span class="op">=</span> <span class="va">fusion.vars</span>,</span></span>
<span class="r-in"><span>                  x <span class="op">=</span> <span class="va">predictor.vars</span>,</span></span>
<span class="r-in"><span>                  weight <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 fusion variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 initial predictor variables</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5686 observations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Using all available predictors for each fusion variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Training step 1 of 3: electricity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- R-squared of cluster means: 0.976 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   10.00   84.75  184.00  212.48  331.00  498.00 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Training step 2 of 3: natural_gas</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- R-squared of cluster means: 0.975 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -- Number of neighbors in each cluster:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.0    61.0   130.5   186.5   303.0   498.0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Training step 3 of 3: aircon</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fusion model saved to:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  /home/runner/work/fusionModel/fusionModel/docs/reference/fusion_model.fsn </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total processing time: 7.18 secs </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fuse back onto the donor data (multiple implicates)</span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="fuse.html">fuse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">recs</span>,</span></span>
<span class="r-in"><span>            file <span class="op">=</span> <span class="va">fsn.path</span>,</span></span>
<span class="r-in"><span>            M <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in fuse(data = recs, file = fsn.path, M = 30):</span> unused argument (file = fsn.path)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate validation results but do not generate plots</span></span></span>
<span class="r-in"><span><span class="va">valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="validate.html">validate</a></span><span class="op">(</span>observed <span class="op">=</span> <span class="va">recs</span>,</span></span>
<span class="r-in"><span>                  implicates <span class="op">=</span> <span class="va">sim</span>,</span></span>
<span class="r-in"><span>                  subset_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span>, <span class="st">"education"</span>, <span class="st">"race"</span>, <span class="st">"urban_rural"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  weight <span class="op">=</span> <span class="st">"weight"</span>,</span></span>
<span class="r-in"><span>                  plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in as.data.table(implicates):</span> object 'sim' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create validation plots</span></span></span>
<span class="r-in"><span><span class="va">valid</span> <span class="op">&lt;-</span> <span class="fu">plot_valid</span><span class="op">(</span><span class="va">valid</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in plot_valid(valid):</span> object 'valid' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View some of the plots</span></span></span>
<span class="r-in"><span><span class="va">valid</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">est</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'valid' not found</span>
<span class="r-in"><span><span class="va">valid</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">moe</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'valid' not found</span>
<span class="r-in"><span><span class="va">valid</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">electricity</span><span class="op">$</span><span class="va">bias</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'valid' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Can also save the plots to disk at creation</span></span></span>
<span class="r-in"><span><span class="co"># Will save .png files to 'valid_plots' folder in working directory</span></span></span>
<span class="r-in"><span><span class="co"># Note that it is fine to pass a 'valid' object with existing $plots slot</span></span></span>
<span class="r-in"><span><span class="co"># In that case, the plots are simply re-generated</span></span></span>
<span class="r-in"><span><span class="va">vplots</span> <span class="op">&lt;-</span> <span class="fu">plot_valid</span><span class="op">(</span><span class="va">valid</span>,</span></span>
<span class="r-in"><span>                     path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"valid_plots"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in plot_valid(valid, path = file.path(getwd(), "valid_plots"), width = 8,     height = 6):</span> object 'valid' not found</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Kevin Ummel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Data fusion and analysis of synthetic data in R.">
<title>Data fusion and analysis of synthetic data in R • fusionModel</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Data fusion and analysis of synthetic data in R">
<meta property="og:description" content="Data fusion and analysis of synthetic data in R.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">fusionModel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="fusionmodel">fusionModel<a class="anchor" aria-label="anchor" href="#fusionmodel"></a>
</h1></div>
<p>Kevin Ummel (<a href="mailto:ummel@berkeley.edu" class="email">ummel@berkeley.edu</a>)</p>
<ul>
<li><a href="#overview" id="toc-overview">Overview</a></li>
<li><a href="#motivation" id="toc-motivation">Motivation</a></li>
<li><a href="#methodology" id="toc-methodology">Methodology</a></li>
<li><a href="#installation" id="toc-installation">Installation</a></li>
<li><a href="#simple-fusion" id="toc-simple-fusion">Simple fusion</a></li>
<li><a href="#advanced-fusion" id="toc-advanced-fusion">Advanced fusion</a></li>
<li><a href="#analyzing-fused-data" id="toc-analyzing-fused-data">Analyzing fused data</a></li>
<li><a href="#validating-fusion-models" id="toc-validating-fusion-models">Validating fusion models</a></li>
</ul>
</div>
<div class="section level1">
<h1 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h1>
<p><strong>fusionModel</strong> enables variables unique to a “donor” dataset to be statistically simulated for (i.e. <em>fused to</em>) a “recipient” dataset. Variables common to both the donor and recipient are used to model and simulate the fused variables. The package provides a simple and efficient interface for general data fusion in <em>R</em>, leveraging state-of-the-art machine learning algorithms from Microsoft’s <a href="https://lightgbm.readthedocs.io/en/latest/" class="external-link">LightGBM</a> framework. It also provides tools for analyzing synthetic/simulated data, calculating uncertainty, and validating fusion output.</p>
<p>fusionModel was developed to allow statistical integration of microdata from disparate social surveys. It is the data fusion workhorse underpinning the larger fusionACS data platform under development at the <a href="https://sc2.berkeley.edu/fusionacs-people/" class="external-link">Socio-Spatial Climate Collaborative</a>. In this context, fusionModel is used to fuse variables from a range of social surveys onto microdata from the American Community Survey, allowing for analysis and spatial resolution otherwise impossible.</p>
</div>
<div class="section level1">
<h1 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h1>
<p>The desire to “fuse” or otherwise integrate independent datasets has a long history, dating to at least the early 1970’s (<a href="https://www.nber.org/system/files/chapters/c10115/c10115.pdf" class="external-link">Ruggles and Ruggles 1974</a>; <a href="https://www.nber.org/system/files/chapters/c10116/c10116.pdf" class="external-link">Alter 1974</a>). Social scientists have long recognized that large amounts of unconnected data are “out there” – usually concerning the characteristics of households and individuals (i.e. microdata) – which we would, ideally, like to integrate and analyze as a whole. This aim falls under the general heading of “Statistical Data Integration” (SDI) (<a href="https://content.iospress.com/articles/statistical-journal-of-the-iaos/sji210835" class="external-link">Lewaa et al. 2021</a>).</p>
<p>The most prominent examples of data fusion have involved administrative record linkage. This consists of exact matching or probabilistic linking of independent datasets, using observable information like social security numbers, names, or birth dates of individuals. Record linkage is the gold standard and can yield incredibly important insights and high levels of statistical confidence, as evidenced by the pioneering work of <a href="https://opportunityinsights.org/team/raj-chetty/" class="external-link">Raj Chetty</a> and colleagues.</p>
<p>However, record linkage is rarely feasible for the kinds of microdata that most researchers use day-to-day (nevermind the difficulty of accessing administrative data). While the explosion of online tracking and social network data will undoubtedly offer new lines of analysis, for the time being, at least, social survey microdata remain indispensable. The challenge and promise recognized 50 years ago by Nancy and Richard Ruggles remains true today:</p>
<blockquote>
<p>Unfortunately, no single microdata set contains all of the different kinds of information required for the problems which the economist wishes to analyze. Different microdata sets contain different kinds of information…A great deal of information is collected on a sample basis. Where two samples are involved the probability of the same individual appearing in both may be very small, so that exact matching is impossible. Other methods of combining the types of information contained in the two different samples into one microdata set will be required. (Ruggles and Ruggles 1974; 353-354)</p>
</blockquote>
<p>Practitioners regularly impute or otherwise predict a variable or two from one dataset on to another. Piecemeal, <em>ad hoc</em> data fusion is a common necessity of quantitative research. Proper data fusion, on the other hand, seeks to systematically combine “two different samples into one microdata set”.</p>
<p>The size and nature of the samples involved and the intended analyses strongly influence the choice of data integration technique and the structure of the output. This has led to the relevant literature being both diverse and convoluted, as practitioners take on different data “setups” and objectives. In the context of fusionACS, we are interested in the following problem:</p>
<p>We have microdata from two independent surveys, A and B, that sample the same underlying population and time period (e.g. occupied U.S. households nationwide in 2018). We specify that A is the “recipient” dataset and B is the “donor”. The goal is to generate a new dataset, C, that has the original survey responses of A plus a realistic representation of how each respondent in A might have answered the questionnaire of survey B. To do this, we identify a set of common/shared variables X that both surveys solicit. We then attempt to fuse a set of variables unique to B – call them Z, the “fusion variables” – onto the original microdata of A, conditional on X.</p>
</div>
<div class="section level1">
<h1 id="methodology">Methodology<a class="anchor" aria-label="anchor" href="#methodology"></a>
</h1>
<p>The fusion strategy implemented in the fusionModel package borrows and expands upon ideas from the statistical matching (<a href="https://onlinelibrary.wiley.com/doi/book/10.1002/0470023554" class="external-link">D’Orazio et al. 2006</a>), imputation (<a href="https://onlinelibrary.wiley.com/doi/book/10.1002/9781119482260" class="external-link">Little and Rubin 2019</a>), and data synthesis (<a href="https://link.springer.com/book/10.1007/978-1-4614-0326-5" class="external-link">Drechsler 2011</a>) literatures to create a flexible data fusion tool. It employs variable-<em>k</em>, conditional expectation matching that leverages high-performance gradient boosting algorithms. The package accommodates fusion of many variables, individually or in blocks, and efficient computation when the recipient is large relative to the donor.</p>
<p>Specifically, the goal was to create a data fusion tool that meets the following requirements:</p>
<ol style="list-style-type: decimal">
<li>Accommodate donor and recipient datasets with divergent sample sizes</li>
<li>Handle continuous, categorical, and semi-continuous (zero-inflated) variable types</li>
<li>Ensure realistic values for fused variables</li>
<li>Scale efficiently for larger datasets</li>
<li>Fuse variables “one-by-one” or in “blocks”</li>
<li>Employ a data modeling approach that:</li>
</ol>
<ul>
<li>Makes no distributional assumptions (i.e. non-parametric)</li>
<li>Automatically detects non-linear and interaction effects</li>
<li>Automatically selects predictor variables from a potentially large set</li>
<li>Ability to prevent overfitting (e.g. cross-validation)</li>
</ul>
<p>Complete methodological details are available in the fusionACS Guidebook (INSERT LINK).</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ummel/fusionModel"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ummel.github.io/fusionModel/">fusionModel</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>fusionModel v2.<span class="fl">2.1</span> <span class="sc">|</span> https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>ummel<span class="sc">/</span>fusionModel</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="simple-fusion">Simple fusion<a class="anchor" aria-label="anchor" href="#simple-fusion"></a>
</h1>
<p>The package includes example microdata from the <a href="https://www.eia.gov/consumption/residential/data/2015/" class="external-link">2015 Residential Energy Consumption Survey</a> (see <code><a href="reference/recs.html">?recs</a></code> for details). For real-world use cases, the donor and recipient data are typically independent and vary in sample size. For illustrative purposes, we will randomly split the <code>recs</code> microdata into separate “donor” and “recipient” datasets with an equal number of observations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rows to use for donor dataset</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">recs</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create donor and recipient datasets</span></span>
<span><span class="va">donor</span> <span class="op">&lt;-</span> <span class="va">recs</span><span class="op">[</span><span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">16</span>, <span class="fl">20</span><span class="op">:</span><span class="fl">22</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">recipient</span> <span class="op">&lt;-</span> <span class="va">recs</span><span class="op">[</span><span class="op">-</span><span class="va">d</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">14</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Specify fusion and shared/common predictor variables</span></span>
<span><span class="va">predictor.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">recipient</span><span class="op">)</span></span>
<span><span class="va">fusion.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">donor</span><span class="op">)</span>, <span class="va">predictor.vars</span><span class="op">)</span></span></code></pre></div>
<p>The <code>recipient</code> dataset contains 13 variables that are shared with <code>donor</code>. These shared “predictor” variables provide a statistical link between the two datasets. fusionModel exploits the information in these shared variables.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictor.vars</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">"income"</span>      <span class="st">"age"</span>         <span class="st">"race"</span>        <span class="st">"education"</span>   <span class="st">"employment"</span> </span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a> [<span class="dv">6</span>] <span class="st">"hh_size"</span>     <span class="st">"division"</span>    <span class="st">"urban_rural"</span> <span class="st">"climate"</span>     <span class="st">"renter"</span>     </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>[<span class="dv">11</span>] <span class="st">"home_type"</span>   <span class="st">"year_built"</span>  <span class="st">"heat_type"</span>  </span></code></pre></div>
<p>There are 5 “fusion variables” unique to <code>donor</code>. These are the variables that will be fused to <code>recipient</code>. This includes a mix of continuous and categorical (factor) variables.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The variables to be fused</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">donor</span><span class="op">[</span><span class="va">fusion.vars</span><span class="op">]</span>, <span class="va">class</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="sc">$</span>insulation</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"ordered"</span> <span class="st">"factor"</span> </span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="sc">$</span>aircon</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"factor"</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="sc">$</span>square_feet</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"integer"</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="sc">$</span>electricity</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"numeric"</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="sc">$</span>natural_gas</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"numeric"</span></span></code></pre></div>
<p>We create a fusion model using the <code><a href="reference/train.html">train()</a></code> function. The minimal usage is shown below. See <code><a href="reference/train.html">?train</a></code> for additional function arguments and options. By default, this results in a “.fsn” (fusion) object being saved to “fusion_model.fsn” in the current working directory.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Train a fusion model</span></span>
<span><span class="va">fsn.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/train.html">train</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">donor</span>, </span>
<span>                   y <span class="op">=</span> <span class="va">fusion.vars</span>, </span>
<span>                   x <span class="op">=</span> <span class="va">predictor.vars</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="dv">5</span> fusion variables</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="dv">13</span> initial predictor variables</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="dv">2843</span> observations</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>Using all available predictors <span class="cf">for</span> each fusion variable</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>Training step <span class="dv">1</span> of <span class="dv">5</span><span class="sc">:</span> insulation</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>Training step <span class="dv">2</span> of <span class="dv">5</span><span class="sc">:</span> aircon</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>Training step <span class="dv">3</span> of <span class="dv">5</span><span class="sc">:</span> square_feet</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="sc">--</span> R<span class="sc">-</span>squared of cluster means<span class="sc">:</span> <span class="fl">0.967</span> </span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="sc">--</span> Number of neighbors <span class="cf">in</span> each cluster<span class="sc">:</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>   Min. <span class="dv">1</span>st Qu.  Median    Mean <span class="dv">3</span>rd Qu.    Max. </span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>   <span class="fl">10.0</span>    <span class="fl">49.0</span>   <span class="fl">141.0</span>   <span class="fl">200.6</span>   <span class="fl">357.0</span>   <span class="fl">498.0</span> </span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>Training step <span class="dv">4</span> of <span class="dv">5</span><span class="sc">:</span> electricity</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="sc">--</span> R<span class="sc">-</span>squared of cluster means<span class="sc">:</span> <span class="fl">0.966</span> </span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="sc">--</span> Number of neighbors <span class="cf">in</span> each cluster<span class="sc">:</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>   Min. <span class="dv">1</span>st Qu.  Median    Mean <span class="dv">3</span>rd Qu.    Max. </span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>  <span class="fl">10.00</span>   <span class="fl">51.75</span>  <span class="fl">115.00</span>  <span class="fl">176.02</span>  <span class="fl">281.25</span>  <span class="fl">498.00</span> </span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>Training step <span class="dv">5</span> of <span class="dv">5</span><span class="sc">:</span> natural_gas</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="sc">--</span> R<span class="sc">-</span>squared of cluster means<span class="sc">:</span> <span class="fl">0.968</span> </span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="sc">--</span> Number of neighbors <span class="cf">in</span> each cluster<span class="sc">:</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>   Min. <span class="dv">1</span>st Qu.  Median    Mean <span class="dv">3</span>rd Qu.    Max. </span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>   <span class="fl">10.0</span>    <span class="fl">54.0</span>   <span class="fl">129.0</span>   <span class="fl">170.1</span>   <span class="fl">247.0</span>   <span class="fl">499.0</span> </span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>Fusion model saved to<span class="sc">:</span> <span class="er">/</span>home<span class="sc">/</span>kevin<span class="sc">/</span>Documents<span class="sc">/</span>Projects<span class="sc">/</span>fusionModel<span class="sc">/</span>fusion_model.fsn </span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">8.53</span> secs </span></code></pre></div>
<p>To fuse variables to <code>recipient</code>, we simply pass the recipient data and path of the .fsn model to the <code><a href="reference/fuse.html">fuse()</a></code> function. Each variable specified in <code>fusion.vars</code> is fused in the order provided. By default, <code><a href="reference/fuse.html">fuse()</a></code> generates a single implicate (version) of synthetic outcomes. Later, we’ll work with multiple implicates to perform proper analysis and uncertainty estimation.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fuse 'fusion.vars' to the recipient</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fuse.html">fuse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">recipient</span>, </span>
<span>            fsn <span class="op">=</span> <span class="va">fsn.model</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="dv">5</span> fusion variables</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="dv">13</span> initial predictor variables</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="dv">2843</span> observations</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>Generating <span class="dv">1</span> implicate </span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>Fusion step <span class="dv">1</span> of <span class="dv">5</span><span class="sc">:</span> insulation</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>Fusion step <span class="dv">2</span> of <span class="dv">5</span><span class="sc">:</span> aircon</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>Fusion step <span class="dv">3</span> of <span class="dv">5</span><span class="sc">:</span> square_feet</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>Fusion step <span class="dv">4</span> of <span class="dv">5</span><span class="sc">:</span> electricity</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>Fusion step <span class="dv">5</span> of <span class="dv">5</span><span class="sc">:</span> natural_gas</span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">0.8</span> secs </span></code></pre></div>
<p>Let’s look at the the recipient dataset’s fused/simulated variables. Note that your results will look different, because each call to <code><a href="reference/fuse.html">fuse()</a></code> generates a unique, probabilistic set of outcomes.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>   M           insulation                          aircon square_feet</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="dv">1</span>       Well insulated Central air conditioning system        <span class="dv">1956</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="dv">1</span>       Well insulated Central air conditioning system        <span class="dv">1621</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="dv">1</span> Adequately insulated             No air conditioning         <span class="dv">558</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="dv">1</span> Adequately insulated Central air conditioning system        <span class="dv">3072</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> <span class="dv">1</span> Adequately insulated Central air conditioning system        <span class="dv">1010</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="dv">1</span> Adequately insulated             No air conditioning        <span class="dv">1910</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>   electricity natural_gas</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>       <span class="dv">17000</span>         <span class="fl">0.0</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span>        <span class="dv">6070</span>       <span class="fl">146.2</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span>        <span class="dv">1334</span>         <span class="fl">0.0</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span>        <span class="dv">9620</span>       <span class="fl">797.0</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span>       <span class="dv">37500</span>         <span class="fl">0.0</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span>       <span class="dv">11240</span>       <span class="fl">223.0</span></span></code></pre></div>
<p>We can do some quick sanity checks to compare the distribution of the fusion variables in <code>donor</code> with those in <code>sim</code>. This, at least, confirms that the fusion output is not obviously wrong. Later, we’ll perform a formal internal validation exercise using multiple implicates.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare means of the continuous variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>donor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">donor</span><span class="op">[</span><span class="va">fusion.vars</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">sim</span><span class="op">[</span><span class="va">fusion.vars</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>                donor        sim</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>square_feet  <span class="fl">2070.784</span>  <span class="fl">2012.7306</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>electricity <span class="fl">10994.517</span> <span class="fl">10675.6508</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>natural_gas   <span class="fl">338.154</span>   <span class="fl">323.5523</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare frequencies of categorical variable classes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>donor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">donor</span><span class="op">$</span><span class="va">insulation</span><span class="op">)</span>, sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">insulation</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>                     donor  sim</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>Not insulated           <span class="dv">40</span>   <span class="dv">40</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>Poorly insulated       <span class="dv">459</span>  <span class="dv">443</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>Adequately insulated  <span class="dv">1401</span> <span class="dv">1419</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>Well insulated         <span class="dv">943</span>  <span class="dv">941</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>donor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">donor</span><span class="op">$</span><span class="va">aircon</span><span class="op">)</span>, sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">aircon</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>                                           donor  sim</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>Central air conditioning system             <span class="dv">1788</span> <span class="dv">1818</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>Individual window<span class="sc">/</span>wall or portable units     <span class="dv">545</span>  <span class="dv">545</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>Both a central system and individual units   <span class="dv">125</span>  <span class="dv">119</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>No air conditioning                          <span class="dv">385</span>  <span class="dv">361</span></span></code></pre></div>
<p>And we can look at kernel density plots of the non-zero values for the continuous variables to see if the univariate distributions in <code>donor</code> are generally similar in <code>sim</code>.</p>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png"><!-- --></p>
</div>
<div class="section level1">
<h1 id="advanced-fusion">Advanced fusion<a class="anchor" aria-label="anchor" href="#advanced-fusion"></a>
</h1>
<p>For this call to <code><a href="reference/train.html">train()</a></code>, we specify a set of hyperparameters to search over when training each LightGBM gradient boosting model (see <code><a href="reference/train.html">?train</a></code> for details). The hyperparameters can be used to tune the underlying GBM models for better cross-validated performance. We also set <code>nfolds = 10</code> (default is 5) to indicate the number of cross-validation folds to use. Since this requires additional computation, the <code>cores</code> argument is used to enable parallel processing.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Train a fusion model with variable blocks</span></span>
<span><span class="va">fsn.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/train.html">train</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">donor</span>, </span>
<span>                   y <span class="op">=</span> <span class="va">fusion.vars</span>, </span>
<span>                   x <span class="op">=</span> <span class="va">predictor.vars</span>,</span>
<span>                   nfolds <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                   hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>boosting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gbdt"</span>, <span class="st">"goss"</span><span class="op">)</span>,</span>
<span>                                num_leaves <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>                                feature_fraction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="dv">5</span> fusion variables</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="dv">13</span> initial predictor variables</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="dv">2843</span> observations</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>Using all available predictors <span class="cf">for</span> each fusion variable</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>Using OpenMP multithreading within <span class="fu">LightGBM</span> (<span class="dv">2</span> cores)</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>Training step <span class="dv">1</span> of <span class="dv">5</span><span class="sc">:</span> insulation</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>Training step <span class="dv">2</span> of <span class="dv">5</span><span class="sc">:</span> aircon</span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>Training step <span class="dv">3</span> of <span class="dv">5</span><span class="sc">:</span> square_feet</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a><span class="sc">--</span> R<span class="sc">-</span>squared of cluster means<span class="sc">:</span> <span class="fl">0.971</span> </span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a><span class="sc">--</span> Number of neighbors <span class="cf">in</span> each cluster<span class="sc">:</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a>   Min. <span class="dv">1</span>st Qu.  Median    Mean <span class="dv">3</span>rd Qu.    Max. </span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>   <span class="fl">10.0</span>    <span class="fl">61.0</span>   <span class="fl">142.0</span>   <span class="fl">198.4</span>   <span class="fl">330.0</span>   <span class="fl">499.0</span> </span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>Training step <span class="dv">4</span> of <span class="dv">5</span><span class="sc">:</span> electricity</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a><span class="sc">--</span> R<span class="sc">-</span>squared of cluster means<span class="sc">:</span> <span class="fl">0.971</span> </span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a><span class="sc">--</span> Number of neighbors <span class="cf">in</span> each cluster<span class="sc">:</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>   Min. <span class="dv">1</span>st Qu.  Median    Mean <span class="dv">3</span>rd Qu.    Max. </span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a>   <span class="fl">10.0</span>    <span class="fl">61.0</span>   <span class="fl">179.0</span>   <span class="fl">220.7</span>   <span class="fl">388.0</span>   <span class="fl">499.0</span> </span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a>Training step <span class="dv">5</span> of <span class="dv">5</span><span class="sc">:</span> natural_gas</span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a><span class="sc">--</span> R<span class="sc">-</span>squared of cluster means<span class="sc">:</span> <span class="fl">0.959</span> </span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a><span class="sc">--</span> Number of neighbors <span class="cf">in</span> each cluster<span class="sc">:</span></span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a>   Min. <span class="dv">1</span>st Qu.  Median    Mean <span class="dv">3</span>rd Qu.    Max. </span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a>   <span class="fl">10.0</span>    <span class="fl">70.0</span>   <span class="fl">193.0</span>   <span class="fl">217.6</span>   <span class="fl">340.0</span>   <span class="fl">499.0</span> </span>
<span id="cb22-23"><a href="#cb22-23" tabindex="-1"></a>Fusion model saved to<span class="sc">:</span> <span class="er">/</span>home<span class="sc">/</span>kevin<span class="sc">/</span>Documents<span class="sc">/</span>Projects<span class="sc">/</span>fusionModel<span class="sc">/</span>fusion_model.fsn </span>
<span id="cb22-24"><a href="#cb22-24" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">44.9</span> secs </span></code></pre></div>
<p>We generally want to create multiple versions of the simulated fusion variables – called <em>implicates</em> – in order to reduce bias in point estimates and calculate associated uncertainty. We can do this using the <code>M</code> argument within <code><a href="reference/fuse.html">fuse()</a></code>. Here we generate 10 implicates; i.e. 10 unique, probabilistic representations of what the recipient records might look like with respect to the fusion variables.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fuse multiple implicates to the recipient</span></span>
<span><span class="va">sim10</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fuse.html">fuse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">recipient</span>, </span>
<span>              fsn <span class="op">=</span> <span class="va">fsn.model</span>,</span>
<span>              M <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="dv">5</span> fusion variables</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="dv">13</span> initial predictor variables</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="dv">2843</span> observations</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>Generating <span class="dv">10</span> implicates </span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>Fusion step <span class="dv">1</span> of <span class="dv">5</span><span class="sc">:</span> insulation</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>Fusion step <span class="dv">2</span> of <span class="dv">5</span><span class="sc">:</span> aircon</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>Fusion step <span class="dv">3</span> of <span class="dv">5</span><span class="sc">:</span> square_feet</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>Fusion step <span class="dv">4</span> of <span class="dv">5</span><span class="sc">:</span> electricity</span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>Fusion step <span class="dv">5</span> of <span class="dv">5</span><span class="sc">:</span> natural_gas</span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">2.38</span> secs </span></code></pre></div>
<p>Note that each implicate in <code>sim10</code> is identified by the “M” variable/column.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>   M           insulation                                   aircon square_feet</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="dv">1</span>       Well insulated          Central air conditioning system        <span class="dv">1728</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="dv">1</span> Adequately insulated          Central air conditioning system        <span class="dv">1492</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="dv">1</span>       Well insulated                      No air conditioning         <span class="dv">636</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="dv">1</span>       Well insulated          Central air conditioning system        <span class="dv">2948</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> <span class="dv">1</span>       Well insulated Individual window<span class="sc">/</span>wall or portable units        <span class="dv">1140</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="dv">1</span> Adequately insulated                      No air conditioning        <span class="dv">1579</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>   electricity natural_gas</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>       <span class="dv">13700</span>         <span class="fl">0.0</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span>       <span class="dv">15200</span>         <span class="fl">0.0</span></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span>        <span class="dv">1880</span>        <span class="fl">89.7</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span>        <span class="dv">8670</span>       <span class="fl">651.0</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span>       <span class="dv">14460</span>         <span class="fl">0.0</span></span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span>       <span class="dv">14220</span>         <span class="fl">0.0</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sim10</span><span class="op">$</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>   <span class="dv">1</span>    <span class="dv">2</span>    <span class="dv">3</span>    <span class="dv">4</span>    <span class="dv">5</span>    <span class="dv">6</span>    <span class="dv">7</span>    <span class="dv">8</span>    <span class="dv">9</span>   <span class="dv">10</span> </span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="dv">2843</span> <span class="dv">2843</span> <span class="dv">2843</span> <span class="dv">2843</span> <span class="dv">2843</span> <span class="dv">2843</span> <span class="dv">2843</span> <span class="dv">2843</span> <span class="dv">2843</span> <span class="dv">2843</span> </span></code></pre></div>
</div>
<div class="section level1">
<h1 id="analyzing-fused-data">Analyzing fused data<a class="anchor" aria-label="anchor" href="#analyzing-fused-data"></a>
</h1>
<p>The fused values are inherently probabilistic, reflecting uncertainty in the underlying statistical models. Multiple implicates are needed to calculate unbiased point estimates and associated uncertainty for any particular analysis of the data. In general, more implicates is preferable but requires more computation.</p>
<p>Since proper analysis of multiple implicates can be rather cumbersome – both from a coding and mathematical standpoint – the <code><a href="reference/analyze.html">analyze()</a></code> function provides a convenient way to calculate point estimates and associated uncertainty for common analyses. Potential analyses currently include variable means, proportions, sums, counts, and medians, (optionally) calculated for population subgroups.</p>
<p>For example, to calculate the mean value of the “electricity” variable across all observations in the recipient dataset, we do the following.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/analyze.html">analyze</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="st">"electricity"</span><span class="op">)</span>,</span>
<span>        implicates <span class="op">=</span> <span class="va">sim10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>Using <span class="dv">10</span> implicates</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>Assuming uniform sample weights</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">0.0344</span> secs </span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>      N           y level type      est      moe</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="dv">2843</span> electricity    <span class="cn">NA</span> mean <span class="fl">10808.86</span> <span class="fl">232.2422</span></span></code></pre></div>
<p>When the response variable is categorical, <code><a href="reference/analyze.html">analyze()</a></code> automatically returns the proportions associated with each factor level.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/analyze.html">analyze</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="st">"aircon"</span><span class="op">)</span>,</span>
<span>        implicates <span class="op">=</span> <span class="va">sim10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>Using <span class="dv">10</span> implicates</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>Assuming uniform sample weights</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">0.0903</span> secs </span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>      N      y                                      level       type        est</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="dv">2843</span> aircon            Central air conditioning system proportion <span class="fl">0.62866690</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="dv">2843</span> aircon   Individual window<span class="sc">/</span>wall or portable units proportion <span class="fl">0.19212100</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="dv">2843</span> aircon Both a central system and individual units proportion <span class="fl">0.04400281</span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="dv">2843</span> aircon                        No air conditioning proportion <span class="fl">0.13520929</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>           moe</span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="fl">0.017603881</span></span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="fl">0.015537772</span></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="fl">0.007524075</span></span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="fl">0.014413665</span></span></code></pre></div>
<p>If we want to perform an analysis across subsets of the recipient population – for example, calculate the mean value of “electricity” by household “income” – we can use the <code>by</code> and <code>static</code> arguments. We see that mean electricity consumption increases with household income.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/analyze.html">analyze</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="st">"electricity"</span><span class="op">)</span>,</span>
<span>        implicates <span class="op">=</span> <span class="va">sim10</span>,</span>
<span>        static <span class="op">=</span> <span class="va">recipient</span>,</span>
<span>        by <span class="op">=</span> <span class="st">"income"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>Using <span class="dv">10</span> implicates</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>Assuming uniform sample weights</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">0.0229</span> secs </span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>                 income   N           y level type       est       moe</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>    Less than <span class="sc">$</span><span class="dv">20</span>,<span class="dv">000</span> <span class="dv">471</span> electricity    <span class="cn">NA</span> mean  <span class="fl">8884.312</span>  <span class="fl">478.0797</span></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span>    <span class="er">$</span><span class="dv">20</span>,<span class="dv">000</span> <span class="sc">-</span> <span class="er">$</span><span class="dv">39</span>,<span class="dv">999</span> <span class="dv">645</span> electricity    <span class="cn">NA</span> mean  <span class="fl">9719.018</span>  <span class="fl">456.4553</span></span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span>    <span class="er">$</span><span class="dv">40</span>,<span class="dv">000</span> <span class="sc">-</span> <span class="er">$</span><span class="dv">59</span>,<span class="dv">999</span> <span class="dv">464</span> electricity    <span class="cn">NA</span> mean <span class="fl">10537.228</span>  <span class="fl">538.0130</span></span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span>   <span class="er">$</span><span class="dv">60</span>,<span class="dv">000</span> to <span class="sc">$</span><span class="dv">79</span>,<span class="dv">999</span> <span class="dv">372</span> electricity    <span class="cn">NA</span> mean <span class="fl">11314.790</span>  <span class="fl">572.3587</span></span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span>   <span class="er">$</span><span class="dv">80</span>,<span class="dv">000</span> to <span class="sc">$</span><span class="dv">99</span>,<span class="dv">999</span> <span class="dv">248</span> electricity    <span class="cn">NA</span> mean <span class="fl">11550.401</span>  <span class="fl">693.7652</span></span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="er">$</span><span class="dv">100</span>,<span class="dv">000</span> to <span class="sc">$</span><span class="dv">119</span>,<span class="dv">999</span> <span class="dv">222</span> electricity    <span class="cn">NA</span> mean <span class="fl">12138.498</span>  <span class="fl">850.3994</span></span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a><span class="dv">7</span><span class="sc">:</span> <span class="er">$</span><span class="dv">120</span>,<span class="dv">000</span> to <span class="sc">$</span><span class="dv">139</span>,<span class="dv">999</span> <span class="dv">119</span> electricity    <span class="cn">NA</span> mean <span class="fl">12490.518</span> <span class="fl">1113.5339</span></span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a><span class="dv">8</span><span class="sc">:</span>     <span class="er">$</span><span class="dv">140</span>,<span class="dv">000</span> or more <span class="dv">302</span> electricity    <span class="cn">NA</span> mean <span class="fl">13683.182</span>  <span class="fl">728.6027</span></span></code></pre></div>
<p>It is also possible to do multiple kinds of analyses in a single call to <code><a href="reference/analyze.html">analyze()</a></code>. For example, the following call calculates the mean value of “natural_gas” and “square_feet”, the median value of “square_feet”, and the sum of “electricity” (i.e. total consumption) and “insulation” (i.e. total count of each level). All of these estimates are calculated for each population subgroup defined by the intersection of “race” and “urban_rural” status.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/analyze.html">analyze</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"natural_gas"</span>, <span class="st">"square_feet"</span><span class="op">)</span>,</span>
<span>                           median <span class="op">=</span> <span class="st">"square_feet"</span>,</span>
<span>                           sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"electricity"</span>, <span class="st">"insulation"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  implicates <span class="op">=</span> <span class="va">sim10</span>,</span>
<span>                  static <span class="op">=</span> <span class="va">recipient</span>,</span>
<span>                  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"race"</span>, <span class="st">"urban_rural"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>Using <span class="dv">10</span> implicates</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>Assuming uniform sample weights</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">1.63</span> secs </span></code></pre></div>
<p>We can then (for example) isolate the results for white households in rural areas. Notice that the mean estimate of “square_feet” exceeds the median, reflecting the skewed distribution.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">race</span> <span class="op">==</span> <span class="st">"White"</span> <span class="op">&amp;</span> <span class="va">urban_rural</span> <span class="op">==</span> <span class="st">"Rural"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>    race urban_rural   N           y                level   type          est</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> White       Rural <span class="dv">503</span> electricity                 <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>    sum <span class="fl">6906696.6100</span></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> White       Rural <span class="dv">503</span>  insulation        Not insulated  count       <span class="fl">5.6000</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> White       Rural <span class="dv">503</span>  insulation     Poorly insulated  count      <span class="fl">68.4000</span></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> White       Rural <span class="dv">503</span>  insulation Adequately insulated  count     <span class="fl">209.7000</span></span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> White       Rural <span class="dv">503</span>  insulation       Well insulated  count     <span class="fl">219.3000</span></span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> White       Rural <span class="dv">503</span> natural_gas                 <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>   mean     <span class="fl">157.5723</span></span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a><span class="dv">7</span><span class="sc">:</span> White       Rural <span class="dv">503</span> square_feet                 <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>   mean    <span class="fl">2387.3509</span></span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a><span class="dv">8</span><span class="sc">:</span> White       Rural <span class="dv">503</span> square_feet                 <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> median    <span class="fl">2159.4000</span></span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a>            moe</span>
<span id="cb38-11"><a href="#cb38-11" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="fl">3.115890e+05</span></span>
<span id="cb38-12"><a href="#cb38-12" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="fl">5.653837e+00</span></span>
<span id="cb38-13"><a href="#cb38-13" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="fl">2.178315e+01</span></span>
<span id="cb38-14"><a href="#cb38-14" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="fl">3.144372e+01</span></span>
<span id="cb38-15"><a href="#cb38-15" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> <span class="fl">3.613723e+01</span></span>
<span id="cb38-16"><a href="#cb38-16" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="fl">2.579220e+01</span></span>
<span id="cb38-17"><a href="#cb38-17" tabindex="-1"></a><span class="dv">7</span><span class="sc">:</span> <span class="fl">1.164896e+02</span></span>
<span id="cb38-18"><a href="#cb38-18" tabindex="-1"></a><span class="dv">8</span><span class="sc">:</span> <span class="fl">1.573095e+02</span></span></code></pre></div>
<p>More complicated analyses can be performed using the custom <code>fun</code> argument to <code><a href="reference/analyze.html">analyze()</a></code>. See the Examples section of <code><a href="reference/analyze.html">?analyze</a></code>.</p>
</div>
<div class="section level1">
<h1 id="validating-fusion-models">Validating fusion models<a class="anchor" aria-label="anchor" href="#validating-fusion-models"></a>
</h1>
<p>The <code><a href="reference/validate.html">validate()</a></code> function provides a convenient way to perform internal validation tests on synthetic variables that have been fused back onto the original donor data. This allows us to assess the quality of the underlying fusion model; it is analogous to assessing model skill by comparing predictions to the observed training data.</p>
<p><code><a href="reference/validate.html">validate()</a></code> compares analytical results derived using the multiple-implicate fusion output with those derived using the original donor microdata. By performing analyses on population subsets of varying size, <code><a href="reference/validate.html">validate()</a></code> estimates how the synthetic variables perform for analyses of varying difficulty/complexity. It computes fusion variable means and proportions for subsets of the full sample – separately for both the observed and fused data – and then compares the results.</p>
<p>First, we fuse multiple implicates of the <code>fusion.vars</code> using the original donor data – <em>not</em> the <code>recipient</code> data, as we did previously.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fuse.html">fuse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">donor</span>,</span>
<span>            fsn <span class="op">=</span> <span class="va">fsn.model</span>,</span>
<span>            M <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="dv">5</span> fusion variables</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="dv">13</span> initial predictor variables</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a><span class="dv">2843</span> observations</span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>Generating <span class="dv">40</span> implicates </span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>Fusion step <span class="dv">1</span> of <span class="dv">5</span><span class="sc">:</span> insulation</span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a>Fusion step <span class="dv">2</span> of <span class="dv">5</span><span class="sc">:</span> aircon</span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a>Fusion step <span class="dv">3</span> of <span class="dv">5</span><span class="sc">:</span> square_feet</span>
<span id="cb40-12"><a href="#cb40-12" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb40-13"><a href="#cb40-13" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb40-14"><a href="#cb40-14" tabindex="-1"></a>Fusion step <span class="dv">4</span> of <span class="dv">5</span><span class="sc">:</span> electricity</span>
<span id="cb40-15"><a href="#cb40-15" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb40-16"><a href="#cb40-16" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb40-17"><a href="#cb40-17" tabindex="-1"></a>Fusion step <span class="dv">5</span> of <span class="dv">5</span><span class="sc">:</span> natural_gas</span>
<span id="cb40-18"><a href="#cb40-18" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb40-19"><a href="#cb40-19" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb40-20"><a href="#cb40-20" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">7.8</span> secs </span></code></pre></div>
<p>Next, we pass the <code>sim</code> results to <code><a href="reference/validate.html">validate()</a></code>. The argument <code>subset_vars</code> specifies that we want the validation exercise to compare observed (donor) and simulated point estimates across population subsets defined by “income”, “age”, “race”, and “education”. See <code><a href="reference/validate.html">?validate</a></code> for more details.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/validate.html">validate</a></span><span class="op">(</span>observed <span class="op">=</span> <span class="va">donor</span>,</span>
<span>                  implicates <span class="op">=</span> <span class="va">sim</span>,</span>
<span>                  subset_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span>, <span class="st">"age"</span>, <span class="st">"race"</span>, <span class="st">"education"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>Assuming uniform sample weights</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>One<span class="sc">-</span>hot encoding categorical fusion variables</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>Correlation between observed and fused values<span class="sc">:</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>   Min. <span class="dv">1</span>st Qu.  Median    Mean <span class="dv">3</span>rd Qu.    Max. </span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a>  <span class="fl">0.075</span>   <span class="fl">0.109</span>   <span class="fl">0.255</span>   <span class="fl">0.303</span>   <span class="fl">0.431</span>   <span class="fl">0.774</span> </span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a>Processing validation analyses <span class="cf">for</span> <span class="dv">5</span> fusion variables</span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a>Performed <span class="dv">1430</span> analyses across <span class="dv">130</span> subsets</span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a>Smoothing validation metrics</span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a>Average smoothed performance metrics across subset range<span class="sc">:</span></span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a>             y     est    vad   moe</span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a><span class="dv">1</span>       aircon  <span class="fl">0.0323</span>  <span class="fl">0.689</span>  <span class="fl">1.37</span></span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a><span class="dv">2</span>  electricity  <span class="fl">0.0225</span>  <span class="fl">0.419</span>  <span class="fl">1.06</span></span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a><span class="dv">3</span>   insulation  <span class="fl">0.0390</span>  <span class="fl">0.492</span>  <span class="fl">1.41</span></span>
<span id="cb42-14"><a href="#cb42-14" tabindex="-1"></a><span class="dv">4</span>  natural_gas  <span class="fl">0.0277</span>  <span class="fl">0.500</span>  <span class="fl">1.06</span></span>
<span id="cb42-15"><a href="#cb42-15" tabindex="-1"></a><span class="dv">5</span>  square_feet  <span class="fl">0.0146</span>  <span class="fl">0.788</span>  <span class="fl">1.18</span></span>
<span id="cb42-16"><a href="#cb42-16" tabindex="-1"></a>Creating ggplot2 graphics  </span>
<span id="cb42-17"><a href="#cb42-17" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">3.14</span> secs </span></code></pre></div>
<p>The <code><a href="reference/validate.html">validate()</a></code> output includes ggplot2 graphics that helpfully summarize the validation results. For example, the plot below shows how the observed and simulated point estimates compare, using median absolute percent error as the performance metric. We see that the synthetic data do a very good job reproducing the point estimates for all fusion variables when the population subset in question is reasonably large. For smaller subsets – i.e. more difficult analyses due to small sample size – “square_feet”, “natural_gas”, and “electricity” remain well modeled, but the error increases more rapidly for “aircon” and “insulation”. This information is useful for understanding what kind of reliability we can expect for particular variables and types of analyses, given the underlying fusion model and data.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valid</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">est</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-21-1.png"><!-- --></p>
<p>Happy fusing!</p>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing fusionModel</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kevin Ummel <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kevin Ummel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
